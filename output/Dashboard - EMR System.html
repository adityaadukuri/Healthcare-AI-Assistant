<!DOCTYPE html>
<!-- saved from url=(0044)http://localhost:5001/dashboard?patient_id=4 -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - EMR System</title>
    <link href="./Dashboard - EMR System_files/bootstrap.min.css" rel="stylesheet">
    <link href="./Dashboard - EMR System_files/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-bg: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
        }

        .navbar-brand {
            font-weight: bold;
            color: var(--primary-color) !important;
        }

        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #34495e, #2980b9);
            transform: translateY(-1px);
        }

        .alert {
            border-radius: 8px;
            border: none;
        }

        .section-card {
            transition: all 0.3s ease;
        }

        .section-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .patient-info {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }

        .table {
            border-radius: 8px;
            overflow: hidden;
        }

        .table thead th {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }

        .badge {
            font-size: 0.9em;
            padding: 0.5em 0.8em;
        }

        .loading {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .edit-btn, .save-btn, .cancel-btn, .delete-btn {
            margin: 2px;
        }

        .editable-field {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
        }

        .search-results {
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            position: absolute;
            width: 100%;
            z-index: 1000;
        }

        .search-result-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }

        .search-result-item:hover {
            background-color: #f8f9fa;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }
    </style>
    
<style>
.recording-indicator {
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% {
        opacity: 1;
    }
    50% {
        opacity: 0.3;
    }
    100% {
        opacity: 1;
    }
}

#microphoneBtn.recording {
    background-color: #dc3545;
    border-color: #dc3545;
    color: white;
}

#microphoneBtn.recording:hover {
    background-color: #c82333;
    border-color: #bd2130;
    color: white;
}

.microphone-permissions-alert {
    border-left: 4px solid #dc3545;
    background-color: #f8d7da;
    border-color: #f5c6cb;
}
</style>

<link type="text/css" rel="stylesheet" id="dark-mode-custom-link"><link type="text/css" rel="stylesheet" id="dark-mode-general-link"><style lang="en" type="text/css" id="dark-mode-custom-style"></style><style lang="en" type="text/css" id="dark-mode-native-style"></style><style lang="en" type="text/css" id="dark-mode-native-sheet"></style><link rel="stylesheet" type="text/css" href="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/styles/inject.css"><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/utils/constants.js"></script><div id="vsc-constants-loaded" style="display: none;">Constants loaded at 2025-07-24T13:04:03.389Z</div><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/utils/logger.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/utils/debug-helper.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/utils/dom-utils.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/utils/event-manager.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/core/storage-manager.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/core/settings.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/observers/media-observer.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/observers/mutation-observer.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/core/action-handler.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/core/video-controller.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/ui/controls.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/ui/drag-handler.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/ui/shadow-dom.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/site-handlers/base-handler.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/site-handlers/netflix-handler.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/site-handlers/youtube-handler.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/site-handlers/facebook-handler.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/site-handlers/amazon-handler.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/site-handlers/apple-handler.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/site-handlers/index.js"></script><script src="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/src/content/inject.js"></script><div id="vsc-test-indicator" style="display: none;"></div><!--UIPATH_EXTENSION_ID: conkfbpnllelocpogdmbilgmnkabjfmf--></head>
<body>
    
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="http://localhost:5001/dashboard">
                <i class="fas fa-heartbeat"></i> EMR System
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    <i class="fas fa-user"></i> Welcome, admin
                </span>
                <a class="btn btn-outline-danger btn-sm" href="http://localhost:5001/logout">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>
    </nav>
    

    <main class="container-fluid py-4">
        
<div id="alerts-container">
                
            </div>

<!-- Patient Search Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="fas fa-search"></i> Patient Search</h5>
                <div>
                    <button id="xrayAnalysisBtn" class="btn btn-primary me-2" onclick="openXrayAnalysis()">
                        <i class="fas fa-x-ray"></i> X-ray Analysis
                    </button>
                    <a href="http://localhost:5001/add-patient" class="btn btn-success">
                        <i class="fas fa-user-plus"></i> Add New Patient
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="position-relative">
                            <input type="text" id="patient-search" class="form-control form-control-lg" placeholder="Search patients by name..." autocomplete="off">
                            <div id="search-results" class="search-results" style="display: none;"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div id="selected-patient-info" class="patient-info" style="">
                            <h6>Selected Patient:</h6>
                            <div id="patient-summary">
        <strong>Joshua Hernandez</strong><br>
        <small>DOB: June 5, 1948 | 
               Gender: Male</small>
    </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Patient Details Section -->
<div id="patient-details" style="" class="fade-in">
    <!-- Demographics Section -->
    <div class="row">
        <div class="col-12">
            <div class="card section-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5><i class="fas fa-user"></i> Demographics</h5>
                    <button class="btn btn-outline-light btn-sm" onclick="toggleEdit(&#39;demographics&#39;)">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                </div>
                <div class="card-body">
                    <div id="demographics-content">
        <div class="row">
            <div class="col-md-6">
                <p><strong>First Name:</strong> <span data-field="first_name">Joshua</span></p>
                <p><strong>Last Name:</strong> <span data-field="last_name">Hernandez</span></p>
                <p><strong>Date of Birth:</strong> <span data-field="date_of_birth">June 5, 1948</span></p>
                <p><strong>Gender:</strong> <span data-field="gender">Male</span></p>
                <p><strong>Phone:</strong> <span data-field="phone">(308) 837-1416</span></p>
            </div>
            <div class="col-md-6">
                <p><strong>Email:</strong> <span data-field="email">joshua.hernandez@email.com</span></p>
                <p><strong>Address:</strong> <span data-field="address">4033 Pine St, New York, IL 75354</span></p>
                <p><strong>Emergency Contact:</strong> <span data-field="emergency_contact">Charles Hernandez - (240) 283-5935</span></p>
                <p><strong>Insurance:</strong> <span data-field="insurance">Cigna - Policy #CG716443</span></p>
            </div>
        </div>
    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Medical Information Tabs -->
    <div class="row">
        <div class="col-12">
            <div class="card section-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <h5 class="mb-0"><i class="fas fa-stethoscope"></i> Medical Information</h5>
                        <div id="recordingStatus" class="ms-3" style="display: none;">
                            <small class="text-danger">
                                <i class="fas fa-circle recording-indicator"></i> Recording...
                            </small>
                        </div>
                    </div>
                    <button id="microphoneBtn" class="btn btn-outline-danger" onclick="toggleRecording()" title="Voice Recording">
                        <i class="fas fa-microphone"></i> <span id="micButtonText">Start Recording</span>
                    </button>
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs mb-3" id="medical-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="medications-tab" data-bs-toggle="tab" data-bs-target="#medications" type="button" role="tab" aria-selected="false">
                                <i class="fas fa-pills"></i> Medications
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="conditions-tab" data-bs-toggle="tab" data-bs-target="#conditions" type="button" role="tab" aria-selected="false">
                                <i class="fas fa-heartbeat"></i> Conditions
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="diagnosis-tab" data-bs-toggle="tab" data-bs-target="#diagnosis" type="button" role="tab" aria-selected="false">
                                <i class="fas fa-diagnosis"></i> Diagnosis
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="clinical-notes-tab" data-bs-toggle="tab" data-bs-target="#clinical-notes" type="button" role="tab" aria-selected="true">
                                <i class="fas fa-notes-medical"></i> Clinical Notes
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="allergies-tab" data-bs-toggle="tab" data-bs-target="#allergies" type="button" role="tab">
                                <i class="fas fa-exclamation-triangle"></i> Allergies
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="immunizations-tab" data-bs-toggle="tab" data-bs-target="#immunizations" type="button" role="tab">
                                <i class="fas fa-syringe"></i> Immunizations
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="appointments-tab" data-bs-toggle="tab" data-bs-target="#appointments" type="button" role="tab">
                                <i class="fas fa-calendar-alt"></i> Appointments
                            </button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="medical-tab-content">
                        <div class="tab-pane fade" id="medications" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6>Current Medications</h6>
                                <button class="btn btn-primary btn-sm" onclick="addNewItem(&#39;medications&#39;)">
                                    <i class="fas fa-plus"></i> Add Medication
                                </button>
                            </div>
                            <div id="medications-content">
        <div class="card mb-2" data-item-id="10">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Aspirin 325mg</h6>
                        <p class="card-text">
                            <strong>Frequency:</strong> Once daily<br>
                            <strong>Start Date:</strong> May 30, 2025<br>
                            <strong>Prescribing Doctor:</strong> Dr. Miller<br>
                            <span class="badge bg-success">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;medications&#39;, &#39;10&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;medications&#39;, &#39;10&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="9">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Metformin 500mg</h6>
                        <p class="card-text">
                            <strong>Frequency:</strong> Once daily<br>
                            <strong>Start Date:</strong> May 6, 2024<br>
                            <strong>Prescribing Doctor:</strong> Dr. Taylor<br>
                            <span class="badge bg-success">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;medications&#39;, &#39;9&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;medications&#39;, &#39;9&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="8">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Lisinopril 5mg</h6>
                        <p class="card-text">
                            <strong>Frequency:</strong> Once daily<br>
                            <strong>Start Date:</strong> March 11, 2025<br>
                            <strong>Prescribing Doctor:</strong> Dr. Anderson<br>
                            <span class="badge bg-success">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;medications&#39;, &#39;8&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;medications&#39;, &#39;8&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="7">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Levothyroxine 25mcg</h6>
                        <p class="card-text">
                            <strong>Frequency:</strong> Once daily<br>
                            <strong>Start Date:</strong> March 29, 2024<br>
                            <strong>Prescribing Doctor:</strong> Dr. Thomas<br>
                            <span class="badge bg-success">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;medications&#39;, &#39;7&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;medications&#39;, &#39;7&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="6">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Atorvastatin 20mg</h6>
                        <p class="card-text">
                            <strong>Frequency:</strong> Once daily<br>
                            <strong>Start Date:</strong> November 14, 2024<br>
                            <strong>Prescribing Doctor:</strong> Dr. Moore<br>
                            <span class="badge bg-success">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;medications&#39;, &#39;6&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;medications&#39;, &#39;6&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
                        </div>
                        
                        <div class="tab-pane fade" id="conditions" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6>Medical Conditions</h6>
                                <button class="btn btn-primary btn-sm" onclick="addNewItem(&#39;conditions&#39;)">
                                    <i class="fas fa-plus"></i> Add Condition
                                </button>
                            </div>
                            <div id="conditions-content">
        <div class="card mb-2" data-item-id="36">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">X-ray Finding: Lung Opacity</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> Z87.891<br>
                            <strong>Date Diagnosed:</strong> July 24, 2025<br>
                            <strong>Severity:</strong> Severe<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;36&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;36&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="35">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">X-ray Finding: Mass</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> Z87.891<br>
                            <strong>Date Diagnosed:</strong> July 24, 2025<br>
                            <strong>Severity:</strong> Moderate<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;35&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;35&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="34">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">X-ray Finding: Nodule</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> Z87.891<br>
                            <strong>Date Diagnosed:</strong> July 24, 2025<br>
                            <strong>Severity:</strong> Moderate<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;34&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;34&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="33">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">X-ray Finding: Pleural_Thickening</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> Z87.891<br>
                            <strong>Date Diagnosed:</strong> July 24, 2025<br>
                            <strong>Severity:</strong> Moderate<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;33&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;33&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="32">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">X-ray Finding: Pneumonia</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> Z87.891<br>
                            <strong>Date Diagnosed:</strong> July 24, 2025<br>
                            <strong>Severity:</strong> Moderate<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;32&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;32&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="31">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">X-ray Finding: Effusion</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> Z87.891<br>
                            <strong>Date Diagnosed:</strong> July 24, 2025<br>
                            <strong>Severity:</strong> Moderate<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;31&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;31&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="30">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">X-ray Finding: Fibrosis</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> Z87.891<br>
                            <strong>Date Diagnosed:</strong> July 24, 2025<br>
                            <strong>Severity:</strong> Moderate<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;30&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;30&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="29">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">X-ray Finding: Emphysema</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> Z87.891<br>
                            <strong>Date Diagnosed:</strong> July 24, 2025<br>
                            <strong>Severity:</strong> Moderate<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;29&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;29&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="28">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">X-ray Finding: Infiltration</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> Z87.891<br>
                            <strong>Date Diagnosed:</strong> July 24, 2025<br>
                            <strong>Severity:</strong> Moderate<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;28&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;28&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="27">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">X-ray Finding: Consolidation</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> Z87.891<br>
                            <strong>Date Diagnosed:</strong> July 24, 2025<br>
                            <strong>Severity:</strong> Moderate<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;27&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;27&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Obesity</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> E66.9<br>
                            <strong>Date Diagnosed:</strong> April 9, 2022<br>
                            <strong>Severity:</strong> Severe<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;4&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;4&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Hypertension</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> I10<br>
                            <strong>Date Diagnosed:</strong> October 16, 2022<br>
                            <strong>Severity:</strong> Moderate<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;3&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;3&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="2">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Type 2 Diabetes</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> E11<br>
                            <strong>Date Diagnosed:</strong> October 2, 2020<br>
                            <strong>Severity:</strong> Controlled<br>
                            <span class="badge bg-warning">Active</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;conditions&#39;, &#39;2&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;conditions&#39;, &#39;2&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
                        </div>
                        
                        <div class="tab-pane fade" id="diagnosis" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6>Diagnosis History</h6>
                                <button class="btn btn-primary btn-sm" onclick="addNewItem(&#39;diagnosis&#39;)">
                                    <i class="fas fa-plus"></i> Add Diagnosis
                                </button>
                            </div>
                            <div id="diagnosis-content">
        <div class="card mb-2" data-item-id="3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Diagnosis - November 20, 2024</h6>
                        <p class="card-text">
                            <strong>Primary:</strong> Hypertension<br>
                            <strong>Secondary:</strong> Obesity<br>
                            <strong>Provider:</strong> Dr. Wilson<br>
                            <strong>Notes:</strong> Patient showing improvement with current treatment plan.
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;diagnosis&#39;, &#39;3&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;diagnosis&#39;, &#39;3&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
                        </div>
                        
                        <div class="tab-pane fade active show" id="clinical-notes" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6>Clinical Notes</h6>
                                <button class="btn btn-primary btn-sm" onclick="addNewItem(&#39;clinical_notes&#39;)">
                                    <i class="fas fa-plus"></i> Add Note
                                </button>
                            </div>
                            <div id="clinical-notes-content">
        <div class="card mb-2" data-item-id="46">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Voice Transcription - July 24, 2025</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> Voice Transcription<br>
                            <strong>Note:</strong> 🎤 Voice transcription started at 18:40:55

[18:41:01] Name Joshua Hernandez, infiltration fibrosis, nodules, Mars, La...
[18:41:06] capacity, pneumonia, plural effusion consolidation.

🛑 Voice transcription completed at 18:41:08
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;clinical_notes&#39;, &#39;46&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;clinical_notes&#39;, &#39;46&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="44">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Radiology Report - July 24, 2025</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> AI X-ray Analysis System<br>
                            <strong>Note:</strong> AI ASSISTANT ANALYSIS

══════════════════════════════════════════════════════════════════════════════

X-RAY SOURCE:
• Image File: 000001-1_20250723_235730_8281a141_20250724_183318_6ba0eaa0.jpg
• Analysis Date: 2025-07-24 18:33:46
• Patient ID: 4
• Analysis Method: AI-Powered Deep Learning Model + GPT-4 Clinical Interpretation

══════════════════════════════════════════════════════════════════════════════

SUMMARIZED X-RAY RESULTS:
• CONSOLIDATION: MODERATE confidence (52.9%)
• INFILTRATION: MODERATE confidence (62.6%)
• EMPHYSEMA: MODERATE confidence (50.1%)
• FIBROSIS: MODERATE confidence (63.2%)
• EFFUSION: MODERATE confidence (51.5%)
• PNEUMONIA: MODERATE confidence (51.6%)
• PLEURAL_THICKENING: MODERATE confidence (51.7%)
• NODULE: MODERATE confidence (62.9%)
• MASS: MODERATE confidence (60.2%)
• LUNG OPACITY: HIGH confidence (86.0%)

══════════════════════════════════════════════════════════════════════════════

CLINICAL INTERPRETATION:
# Radiology Report

## Patient Information
- **Patient ID**: 4
- **Name**: Joshua Hernandez
- **Age**: Unknown
- **Gender**: Male

## X-ray Analysis Results

### Primary Findings
The deep learning model analysis of the chest X-ray indicates the following significant findings with probability scores greater than 0.3:

1. **Infiltration**: 0.6259
2. **Fibrosis**: 0.6322
3. **Nodule**: 0.6291
4. **Mass**: 0.6024
5. **Lung Opacity**: 0.8596
6. **Pleural Thickening**: 0.5173
7. **Effusion**: 0.5145
8. **Pneumonia**: 0.5159
9. **Consolidation**: 0.5290
10. **Emphysema**: 0.5012

### Clinical Significance
- **Infiltration and Consolidation**: These findings suggest the presence of fluid or other material within the lung parenchyma, which could indicate infection, inflammation, or other pathological processes.
- **Fibrosis**: Indicates potential scarring of lung tissue, which can be associated with chronic inflammatory processes or previous infections.
- **Nodule and Mass**: These findings suggest the presence of localized growths within the lung, which could range from benign lesions to malignant tumors.
- **Lung Opacity**: A high score suggests significant areas of increased density within the lung fields, which could correlate with various conditions including infection, fluid accumulation, or neoplastic processes.
- **Pleural Thickening and Effusion**: These findings suggest potential pleural involvement, which might indicate inflammation, infection, or malignancy.
- **Pneumonia**: Suggests an infectious process within the lung, consistent with the presence of consolidation and infiltration.
- **Emphysema**: Suggests possible chronic obstructive pulmonary disease (COPD) changes, characterized by over-inflation of air sacs in the lungs.

### Differential Diagnosis
Based on the findings, the following conditions should be considered:
- Infectious processes such as bacterial or viral pneumonia
- Chronic obstructive pulmonary disease (COPD) with emphysematous changes
- Interstitial lung disease with fibrosis
- Possible neoplastic processes, including primary lung cancer or metastatic disease
- Pleural disease, potentially secondary to infection or malignancy

### Recommended Actions
1. **Clinical Correlation**: It is essential to correlate these findings with the patient's clinical history, symptoms, and physical examination.
2. **Further Imaging**: Consider a high-resolution CT scan of the chest for better characterization of nodules, masses, and fibrotic changes.
3. **Laboratory Tests**: Complete blood count, inflammatory markers, and sputum cultures may help identify infectious processes.
4. **Pulmonary Consultation**: Referral to a pulmonologist for further evaluation and management may be warranted.
5. **Biopsy**: If malignancy is suspected, a biopsy of the nodule or mass may be necessary for definitive diagnosis.

### Clinical Summary
The chest X-ray analysis for Joshua Hernandez reveals significant findings of lung infiltration, fibrosis, nodules, masses, and increased lung opacity, suggestive of possible infectious, inflammatory, or neoplastic processes. There is also evidence of pleural involvement and emphysematous changes. Further clinical correlation and additional diagnostic testing are recommended to determine the underlying cause and guide appropriate management.

══════════════════════════════════════════════════════════════════════════════

RECOMMENDED ACTIONS:
• - **Infiltration and Consolidation**: These findings suggest the presence of fluid or other material within the lung parenchyma, which could indicate infection, inflammation, or other pathological processes.
• - **Nodule and Mass**: These findings suggest the presence of localized growths within the lung, which could range from benign lesions to malignant tumors.
• - **Lung Opacity**: A high score suggests significant areas of increased density within the lung fields, which could correlate with various conditions including infection, fluid accumulation, or neoplastic processes.
• - **Pleural Thickening and Effusion**: These findings suggest potential pleural involvement, which might indicate inflammation, infection, or malignancy.
• - **Pneumonia**: Suggests an infectious process within the lung, consistent with the presence of consolidation and infiltration.
• - **Emphysema**: Suggests possible chronic obstructive pulmonary disease (COPD) changes, characterized by over-inflation of air sacs in the lungs.
• Based on the findings, the following conditions should be considered:
• ### Recommended Actions
• 2. **Further Imaging**: Consider a high-resolution CT scan of the chest for better characterization of nodules, masses, and fibrotic changes.
• The chest X-ray analysis for Joshua Hernandez reveals significant findings of lung infiltration, fibrosis, nodules, masses, and increased lung opacity, suggestive of possible infectious, inflammatory, or neoplastic processes. There is also evidence of pleural involvement and emphysematous changes. Further clinical correlation and additional diagnostic testing are recommended to determine the underlying cause and guide appropriate management.
• Clinical correlation recommended for all AI-detected findings
• Consider follow-up imaging if clinically indicated
• Consult radiologist for definitive interpretation
• Correlate with patient symptoms and physical examination
• Review with patient's clinical history and previous imaging

══════════════════════════════════════════════════════════════════════════════

AUTOMATED CONDITIONS CREATED:
• X-ray Finding: Consolidation - Confidence: 52.9%
• X-ray Finding: Infiltration - Confidence: 62.6%
• X-ray Finding: Emphysema - Confidence: 50.1%
• X-ray Finding: Fibrosis - Confidence: 63.2%
• X-ray Finding: Effusion - Confidence: 51.5%
• X-ray Finding: Pneumonia - Confidence: 51.6%
• X-ray Finding: Pleural_Thickening - Confidence: 51.7%
• X-ray Finding: Nodule - Confidence: 62.9%
• X-ray Finding: Mass - Confidence: 60.2%
• X-ray Finding: Lung Opacity - Confidence: 86.0%

══════════════════════════════════════════════════════════════════════════════

⚠️  IMPORTANT DISCLAIMER:
This analysis is generated by AI and should be reviewed by a qualified radiologist.
All findings require clinical correlation and physician review before making
treatment decisions.
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;clinical_notes&#39;, &#39;44&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;clinical_notes&#39;, &#39;44&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="10">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Assessment - August 3, 2024</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> Dr. Brown<br>
                            <strong>Note:</strong> Patient reports feeling well. No changes to treatment plan.
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;clinical_notes&#39;, &#39;10&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;clinical_notes&#39;, &#39;10&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="9">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Assessment - August 14, 2024</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> Dr. Wilson<br>
                            <strong>Note:</strong> Follow-up in 1 month. Referral discussed.
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;clinical_notes&#39;, &#39;9&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;clinical_notes&#39;, &#39;9&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="8">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Consultation - September 10, 2024</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> Dr. Moore<br>
                            <strong>Note:</strong> Vital signs well controlled. Patient compliant with medication.
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;clinical_notes&#39;, &#39;8&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;clinical_notes&#39;, &#39;8&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="7">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Assessment - November 27, 2024</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> Dr. Moore<br>
                            <strong>Note:</strong> Blood pressure within normal range. Good adherence to treatment.
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;clinical_notes&#39;, &#39;7&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;clinical_notes&#39;, &#39;7&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="6">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">History - January 11, 2025</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> Dr. Miller<br>
                            <strong>Note:</strong> Patient reports feeling well. Continue current medications.
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;clinical_notes&#39;, &#39;6&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;clinical_notes&#39;, &#39;6&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
                        </div>
                        
                        <div class="tab-pane fade" id="allergies" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6>Known Allergies</h6>
                                <button class="btn btn-primary btn-sm" onclick="addNewItem(&#39;allergies&#39;)">
                                    <i class="fas fa-plus"></i> Add Allergy
                                </button>
                            </div>
                            <div id="allergies-content">
        <div class="card mb-2" data-item-id="4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Pollen</h6>
                        <p class="card-text">
                            <strong>Reaction:</strong> Sneezing<br>
                            <strong>Severity:</strong> <span class="badge bg-warning">Moderate</span><br>
                            <strong>Date Identified:</strong> November 24, 2022
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;allergies&#39;, &#39;4&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;allergies&#39;, &#39;4&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Codeine</h6>
                        <p class="card-text">
                            <strong>Reaction:</strong> Nausea<br>
                            <strong>Severity:</strong> <span class="badge bg-success">Mild</span><br>
                            <strong>Date Identified:</strong> November 22, 2017
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;allergies&#39;, &#39;3&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;allergies&#39;, &#39;3&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
                        </div>
                        
                        <div class="tab-pane fade" id="immunizations" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6>Immunization Records</h6>
                                <button class="btn btn-primary btn-sm" onclick="addNewItem(&#39;immunizations&#39;)">
                                    <i class="fas fa-plus"></i> Add Immunization
                                </button>
                            </div>
                            <div id="immunizations-content">
        <div class="card mb-2" data-item-id="8">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Tetanus</h6>
                        <p class="card-text">
                            <strong>Date Administered:</strong> January 14, 2024<br>
                            <strong>Provider:</strong> Dr. Thomas<br>
                            <strong>Lot Number:</strong> TD865404
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;immunizations&#39;, &#39;8&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;immunizations&#39;, &#39;8&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="7">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">MMR</h6>
                        <p class="card-text">
                            <strong>Date Administered:</strong> June 18, 2024<br>
                            <strong>Provider:</strong> Dr. Thomas<br>
                            <strong>Lot Number:</strong> MS266142
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;immunizations&#39;, &#39;7&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;immunizations&#39;, &#39;7&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="6">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">HPV</h6>
                        <p class="card-text">
                            <strong>Date Administered:</strong> November 22, 2023<br>
                            <strong>Provider:</strong> Dr. Williams<br>
                            <strong>Lot Number:</strong> CV609805
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;immunizations&#39;, &#39;6&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;immunizations&#39;, &#39;6&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="5">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Hepatitis B</h6>
                        <p class="card-text">
                            <strong>Date Administered:</strong> July 1, 2025<br>
                            <strong>Provider:</strong> Dr. Moore<br>
                            <strong>Lot Number:</strong> HE829934
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;immunizations&#39;, &#39;5&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;immunizations&#39;, &#39;5&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
                        </div>
                        
                        <div class="tab-pane fade" id="appointments" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6>Scheduled Appointments</h6>
                                <button class="btn btn-primary btn-sm" onclick="addNewItem(&#39;appointments&#39;)">
                                    <i class="fas fa-plus"></i> Add Appointment
                                </button>
                            </div>
                            <div id="appointments-content">
        <div class="card mb-2" data-item-id="6">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Follow-up - March 26, 2025 at 10:45:00</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> Dr. Williams<br>
                            <strong>Status:</strong> <span class="badge bg-secondary">Completed</span><br>
                            <strong>Notes:</strong> Follow-up appointment for routine care
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;appointments&#39;, &#39;6&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;appointments&#39;, &#39;6&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="5">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Chronic Care Management - January 15, 2026 at 13:15:00</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> Dr. Rodriguez<br>
                            <strong>Status:</strong> <span class="badge bg-primary">Scheduled</span><br>
                            <strong>Notes:</strong> Chronic Care Management appointment for monitoring
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;appointments&#39;, &#39;5&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;appointments&#39;, &#39;5&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card mb-2" data-item-id="4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Specialist Referral - January 6, 2026 at 08:15:00</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> Dr. Williams<br>
                            <strong>Status:</strong> <span class="badge bg-primary">Scheduled</span><br>
                            <strong>Notes:</strong> Specialist Referral appointment for assessment
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem(&#39;appointments&#39;, &#39;4&#39;)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem(&#39;appointments&#39;, &#39;4&#39;)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Spinner -->
<div id="loading" class="text-center loading" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<!-- Modal for Adding/Editing Items -->
<div class="modal fade" id="itemModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="itemModalTitle">Add Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="itemForm">
                    <div id="itemFormFields"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveItem()">Save</button>
            </div>
        </div>
    </div>
</div>


    </main>

    <script src="./Dashboard - EMR System_files/bootstrap.bundle.min.js"></script>
    <script src="./Dashboard - EMR System_files/jquery-3.6.0.min.js"></script>
    
    <script>
        // Global utility functions
        function showAlert(message, type = 'info', timeout = 5000) {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            $('#alerts-container').html(alertHtml);
            setTimeout(() => {
                $('.alert').alert('close');
            }, timeout);
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function formatDateTime(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>
    
    
<script src="./Dashboard - EMR System_files/audio-recorder.js"></script>
<script>
let currentPatient = null;
let currentSection = null;
let editingItem = null;
let pollingInterval = null;
let lastClinicalNotesHash = null;

// Voice recording variables
let isRecording = false;
let currentNoteId = null;
let recordingEventSource = null;
let audioRecorder = null;

// Simple hash function for comparing clinical notes data
function hashClinicalNotes(notes) {
    if (!notes || notes.length === 0) return 'empty';
    return JSON.stringify(notes.map(n => ({ id: n.id, note: n.note, date: n.date, type: n.type, provider: n.provider })));
}

// Poll clinical notes for real-time updates
function pollClinicalNotes() {
    if (!currentPatient || !currentPatient.id) return;
    
    $.get(`/api/patient/${currentPatient.id}/clinical_notes`)
        .done(function(response) {
            if (response.success && response.data) {
                const newHash = hashClinicalNotes(response.data);
                
                // Only update if data has changed
                if (lastClinicalNotesHash !== null && lastClinicalNotesHash !== newHash) {
                    console.log('Clinical notes updated, refreshing display...');
                    displayClinicalNotes(response.data);
                    
                    // Show a subtle notification
                    showAlert('Clinical notes updated', 'info', 2000);
                }
                
                lastClinicalNotesHash = newHash;
            }
        })
        .fail(function(xhr, status, error) {
            // Silently handle errors to avoid spam in console
            console.debug('Polling error:', error);
        });
}

// Start polling when clinical notes tab is shown
function startClinicalNotesPolling() {
    if (pollingInterval) return; // Already polling
    
    console.log('Starting clinical notes polling...');
    pollingInterval = setInterval(pollClinicalNotes, 500);
}

// Stop polling
function stopClinicalNotesPolling() {
    if (pollingInterval) {
        console.log('Stopping clinical notes polling...');
        clearInterval(pollingInterval);
        pollingInterval = null;
    }
}

// Handle transcription added events
window.addEventListener('transcriptionAdded', function(event) {
    console.log('Transcription added:', event.detail.transcription);
    
    // Immediately refresh clinical notes if we're viewing them
    if (currentPatient && currentPatient.id) {
        const activeTab = $('.nav-link.active').attr('data-bs-target');
        if (activeTab === '#clinical-notes') {
            pollClinicalNotes();
        }
    }
});

// Initialize when page loads
$(document).ready(function() {
    // Initialize audio recorder event listeners
    if (window.EMRAudioRecorder) {
        console.log('Audio recorder available');
    }
});

// Patient search functionality
$('#patient-search').on('input', function() {
    const query = $(this).val().trim();
    if (query.length >= 2) {
        searchPatients(query);
    } else {
        $('#search-results').hide();
    }
});

// Tab change event listeners for polling
$(document).ready(function() {
    // Listen for tab changes
    $('button[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
        const targetTab = $(e.target).attr('data-bs-target');
        
        if (targetTab === '#clinical-notes') {
            startClinicalNotesPolling();
        } else {
            stopClinicalNotesPolling();
        }
    });
    
    // Stop polling when leaving the page
    $(window).on('beforeunload', function() {
        stopClinicalNotesPolling();
    });
    
    // Auto-select patient if patient_id is provided in URL
    const selectedPatientId = "4";
    if (selectedPatientId && selectedPatientId !== "None") {
        selectPatient(selectedPatientId);
    }
});

// Hide search results when clicking outside
$(document).on('click', function(event) {
    if (!$(event.target).closest('#patient-search, #search-results').length) {
        $('#search-results').hide();
    }
});

function searchPatients(query) {
    $.get('/api/patients/search', { q: query })
        .done(function(data) {
            const resultsHtml = data.map(patient => `
                <div class="search-result-item" onclick="selectPatient('${patient.id}')">
                    <strong>${patient.name}</strong><br>
                    <small class="text-muted">DOB: ${formatDate(patient.dob)} | Gender: ${patient.gender}</small>
                </div>
            `).join('');
            
            $('#search-results').html(resultsHtml).show();
        })
        .fail(function() {
            showAlert('Error searching patients', 'danger');
        });
}

function selectPatient(patientId) {
    $('#search-results').hide();
    $('#loading').show();
    
    $.get(`/api/patients/${patientId}`)
        .done(function(data) {
            currentPatient = data;
            displayPatient(data);
            $('#loading').hide();
            
            // Enable X-ray analysis button when patient is selected
            $('#xrayAnalysisBtn').prop('disabled', false);
            // Enable microphone button when patient is selected
            $('#microphoneBtn').prop('disabled', false);
        })
        .fail(function() {
            showAlert('Error loading patient data', 'danger');
            $('#loading').hide();
        });
}

// Voice Recording Functions
function toggleRecording() {
    if (!currentPatient || !currentPatient.id) {
        showAlert('Please select a patient first', 'warning');
        return;
    }
    
    if (isRecording) {
        stopRecording();
    } else {
        startRecording();
    }
}

function startRecording() {
    // Initialize audio recorder if not already done
    if (!audioRecorder) {
        try {
            audioRecorder = new EMRAudioRecorder();
        } catch (error) {
            showAlert('Audio recording not supported in this browser', 'danger');
            return;
        }
    }
    
    // Start the recording session on the backend first
    $.ajax({
        url: '/api/voice/start-recording',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
            patient_id: currentPatient.id,
            provider: 'Voice Transcription'
        }),
        success: function(response) {
            if (response.success) {
                isRecording = true;
                currentNoteId = response.note_id;
                
                // Start browser audio recording
                audioRecorder.startRecording(currentPatient.id, currentNoteId)
                    .then(() => {
                        // Update UI
                        $('#microphoneBtn').addClass('recording').removeClass('btn-outline-danger').addClass('btn-danger');
                        $('#micButtonText').text('Stop Recording');
                        $('#recordingStatus').show();
                        
                        // Start listening for transcription updates
                        startTranscriptionListener();
                        
                        showAlert('Voice recording started', 'success');
                    })
                    .catch((error) => {
                        console.error('Audio recording error:', error);
                        // Stop the backend session since audio failed
                        stopRecordingSession();
                        showAlert('Microphone access denied. Please allow microphone access and try again.', 'danger');
                    });
            } else {
                showAlert('Failed to start recording: ' + (response.error || 'Unknown error'), 'danger');
            }
        },
        error: function(xhr, status, error) {
            showAlert('Error starting recording: ' + error, 'danger');
        }
    });
}

function stopRecording() {
    // Stop browser audio recording
    if (audioRecorder) {
        audioRecorder.stopRecording();
    }
    
    // Stop the backend session
    stopRecordingSession();
}

function stopRecordingSession() {
    $.ajax({
        url: '/api/voice/stop-recording',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
            note_id: currentNoteId
        }),
        success: function(response) {
            isRecording = false;
            currentNoteId = null;
            
            // Update UI
            $('#microphoneBtn').removeClass('recording btn-danger').addClass('btn-outline-danger');
            $('#micButtonText').text('Start Recording');
            $('#recordingStatus').hide();
            
            // Stop listening for transcription updates
            stopTranscriptionListener();
            
            // Refresh clinical notes to show the updated transcription
            if (currentPatient && currentPatient.id) {
                selectPatient(currentPatient.id);
            }
            
            showAlert('Voice recording stopped', 'info');
        },
        error: function(xhr, status, error) {
            showAlert('Error stopping recording: ' + error, 'danger');
            // Reset UI anyway
            isRecording = false;
            currentNoteId = null;
            $('#microphoneBtn').removeClass('recording btn-danger').addClass('btn-outline-danger');
            $('#micButtonText').text('Start Recording');
            $('#recordingStatus').hide();
            stopTranscriptionListener();
        }
    });
}

function startTranscriptionListener() {
    if (!currentNoteId) return;
    
    // Use Server-Sent Events to listen for real-time transcription updates
    recordingEventSource = new EventSource(`/api/voice/transcription-stream/${currentNoteId}`);
    
    recordingEventSource.onmessage = function(event) {
        const data = JSON.parse(event.data);
        if (data.type === 'transcription_update') {
            // Refresh clinical notes to show the latest transcription
            if (currentPatient && currentPatient.id) {
                // Only refresh if we're on the clinical notes tab
                const activeTab = $('.nav-link.active').attr('data-bs-target');
                if (activeTab === '#clinical-notes') {
                    pollClinicalNotes();
                }
            }
        }
    };
    
    recordingEventSource.onerror = function(event) {
        console.error('Transcription stream error:', event);
        stopTranscriptionListener();
    };
}

function stopTranscriptionListener() {
    if (recordingEventSource) {
        recordingEventSource.close();
        recordingEventSource = null;
    }
}

function displayPatient(patient) {
    // Show selected patient info
    $('#patient-summary').html(`
        <strong>${patient.name}</strong><br>
        <small>DOB: ${formatDate(patient.demographics.date_of_birth)} | 
               Gender: ${patient.demographics.gender}</small>
    `);
    $('#selected-patient-info').show();
    
    // Display demographics
    displayDemographics(patient.demographics);
    
    // Display medical sections
    displayMedications(patient.medications);
    displayConditions(patient.conditions);
    displayDiagnosis(patient.diagnosis);
    displayClinicalNotes(patient.clinical_notes);
    displayAllergies(patient.allergies);
    displayImmunizations(patient.immunizations);
    displayAppointments(patient.appointments);
    
    $('#patient-details').show().addClass('fade-in');
}

function displayDemographics(demographics) {
    const html = `
        <div class="row">
            <div class="col-md-6">
                <p><strong>First Name:</strong> <span data-field="first_name">${demographics.first_name}</span></p>
                <p><strong>Last Name:</strong> <span data-field="last_name">${demographics.last_name}</span></p>
                <p><strong>Date of Birth:</strong> <span data-field="date_of_birth">${formatDate(demographics.date_of_birth)}</span></p>
                <p><strong>Gender:</strong> <span data-field="gender">${demographics.gender}</span></p>
                <p><strong>Phone:</strong> <span data-field="phone">${demographics.phone}</span></p>
            </div>
            <div class="col-md-6">
                <p><strong>Email:</strong> <span data-field="email">${demographics.email}</span></p>
                <p><strong>Address:</strong> <span data-field="address">${demographics.address}</span></p>
                <p><strong>Emergency Contact:</strong> <span data-field="emergency_contact">${demographics.emergency_contact}</span></p>
                <p><strong>Insurance:</strong> <span data-field="insurance">${demographics.insurance}</span></p>
            </div>
        </div>
    `;
    $('#demographics-content').html(html);
}

function displayMedications(medications) {
    if (!medications || medications.length === 0) {
        $('#medications-content').html('<p class="text-muted">No medications recorded.</p>');
        return;
    }
    
    const html = medications.map(med => `
        <div class="card mb-2" data-item-id="${med.id}">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">${med.name} ${med.dosage}</h6>
                        <p class="card-text">
                            <strong>Frequency:</strong> ${med.frequency}<br>
                            <strong>Start Date:</strong> ${formatDate(med.start_date)}<br>
                            <strong>Prescribing Doctor:</strong> ${med.prescribing_doctor}<br>
                            <span class="badge bg-${med.status === 'Active' ? 'success' : 'secondary'}">${med.status}</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem('medications', '${med.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem('medications', '${med.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
    
    $('#medications-content').html(html);
}

function displayConditions(conditions) {
    if (!conditions || conditions.length === 0) {
        $('#conditions-content').html('<p class="text-muted">No conditions recorded.</p>');
        return;
    }
    
    const html = conditions.map(condition => `
        <div class="card mb-2" data-item-id="${condition.id}">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">${condition.name}</h6>
                        <p class="card-text">
                            <strong>ICD Code:</strong> ${condition.icd_code}<br>
                            <strong>Date Diagnosed:</strong> ${formatDate(condition.date_diagnosed)}<br>
                            <strong>Severity:</strong> ${condition.severity}<br>
                            <span class="badge bg-${condition.status === 'Active' ? 'warning' : 'secondary'}">${condition.status}</span>
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem('conditions', '${condition.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem('conditions', '${condition.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
    
    $('#conditions-content').html(html);
}

function displayDiagnosis(diagnosis) {
    if (!diagnosis || diagnosis.length === 0) {
        $('#diagnosis-content').html('<p class="text-muted">No diagnosis recorded.</p>');
        return;
    }
    
    const html = diagnosis.map(diag => `
        <div class="card mb-2" data-item-id="${diag.id}">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">Diagnosis - ${formatDate(diag.date)}</h6>
                        <p class="card-text">
                            <strong>Primary:</strong> ${diag.primary_diagnosis}<br>
                            ${diag.secondary_diagnosis ? `<strong>Secondary:</strong> ${diag.secondary_diagnosis}<br>` : ''}
                            <strong>Provider:</strong> ${diag.provider}<br>
                            <strong>Notes:</strong> ${diag.notes}
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem('diagnosis', '${diag.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem('diagnosis', '${diag.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
    
    $('#diagnosis-content').html(html);
}

function displayClinicalNotes(notes) {
    if (!notes || notes.length === 0) {
        $('#clinical-notes-content').html('<p class="text-muted">No clinical notes recorded.</p>');
        lastClinicalNotesHash = hashClinicalNotes(notes);
        return;
    }
    
    const html = notes.map(note => `
        <div class="card mb-2" data-item-id="${note.id}">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">${note.type} - ${formatDate(note.date)}</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> ${note.provider}<br>
                            <strong>Note:</strong> ${note.note}
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem('clinical_notes', '${note.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem('clinical_notes', '${note.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
    
    $('#clinical-notes-content').html(html);
    lastClinicalNotesHash = hashClinicalNotes(notes);
}

function displayAllergies(allergies) {
    if (!allergies || allergies.length === 0) {
        $('#allergies-content').html('<p class="text-muted">No allergies recorded.</p>');
        return;
    }
    
    const html = allergies.map(allergy => `
        <div class="card mb-2" data-item-id="${allergy.id}">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">${allergy.allergen}</h6>
                        <p class="card-text">
                            <strong>Reaction:</strong> ${allergy.reaction}<br>
                            <strong>Severity:</strong> <span class="badge bg-${allergy.severity === 'Severe' ? 'danger' : allergy.severity === 'Moderate' ? 'warning' : 'success'}">${allergy.severity}</span><br>
                            <strong>Date Identified:</strong> ${formatDate(allergy.date_identified)}
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem('allergies', '${allergy.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem('allergies', '${allergy.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
    
    $('#allergies-content').html(html);
}

function displayImmunizations(immunizations) {
    if (!immunizations || immunizations.length === 0) {
        $('#immunizations-content').html('<p class="text-muted">No immunizations recorded.</p>');
        return;
    }
    
    const html = immunizations.map(immun => `
        <div class="card mb-2" data-item-id="${immun.id}">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">${immun.vaccine}</h6>
                        <p class="card-text">
                            <strong>Date Administered:</strong> ${formatDate(immun.date_administered)}<br>
                            <strong>Provider:</strong> ${immun.provider}<br>
                            <strong>Lot Number:</strong> ${immun.lot_number}
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem('immunizations', '${immun.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem('immunizations', '${immun.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
    
    $('#immunizations-content').html(html);
}

function displayAppointments(appointments) {
    if (!appointments || appointments.length === 0) {
        $('#appointments-content').html('<p class="text-muted">No appointments scheduled.</p>');
        return;
    }
    
    const html = appointments.map(appt => `
        <div class="card mb-2" data-item-id="${appt.id}">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="card-title">${appt.type} - ${formatDate(appt.date)} at ${appt.time}</h6>
                        <p class="card-text">
                            <strong>Provider:</strong> ${appt.provider}<br>
                            <strong>Status:</strong> <span class="badge bg-${appt.status === 'Scheduled' ? 'primary' : 'secondary'}">${appt.status}</span><br>
                            <strong>Notes:</strong> ${appt.notes}
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm edit-btn" onclick="editItem('appointments', '${appt.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" onclick="deleteItem('appointments', '${appt.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
    
    $('#appointments-content').html(html);
}

function toggleEdit(section) {
    // This function would enable inline editing for demographics
    // For simplicity, we'll show an alert
    showAlert('Demographics editing feature coming soon!', 'info');
}

function addNewItem(section) {
    currentSection = section;
    editingItem = null;
    showItemModal(section, null);
}

function editItem(section, itemId) {
    currentSection = section;
    const item = currentPatient[section].find(item => item.id === itemId);
    editingItem = item;
    showItemModal(section, item);
}

function showItemModal(section, item) {
    const isEdit = item !== null;
    $('#itemModalTitle').text(isEdit ? `Edit ${section.slice(0, -1)}` : `Add ${section.slice(0, -1)}`);
    
    let fieldsHtml = '';
    
    switch(section) {
        case 'medications':
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Medication Name</label>
                            <input type="text" class="form-control" name="name" value="${item?.name || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Dosage</label>
                            <input type="text" class="form-control" name="dosage" value="${item?.dosage || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Frequency</label>
                            <input type="text" class="form-control" name="frequency" value="${item?.frequency || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Start Date</label>
                            <input type="date" class="form-control" name="start_date" value="${item?.start_date || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Prescribing Doctor</label>
                            <input type="text" class="form-control" name="prescribing_doctor" value="${item?.prescribing_doctor || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-control" name="status" required>
                                <option value="Active" ${item?.status === 'Active' ? 'selected' : ''}>Active</option>
                                <option value="Inactive" ${item?.status === 'Inactive' ? 'selected' : ''}>Inactive</option>
                                <option value="Discontinued" ${item?.status === 'Discontinued' ? 'selected' : ''}>Discontinued</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;
            break;
        case 'conditions':
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Condition Name</label>
                            <input type="text" class="form-control" name="name" value="${item?.name || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">ICD Code</label>
                            <input type="text" class="form-control" name="icd_code" value="${item?.icd_code || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Date Diagnosed</label>
                            <input type="date" class="form-control" name="date_diagnosed" value="${item?.date_diagnosed || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Severity</label>
                            <select class="form-control" name="severity" required>
                                <option value="Mild" ${item?.severity === 'Mild' ? 'selected' : ''}>Mild</option>
                                <option value="Moderate" ${item?.severity === 'Moderate' ? 'selected' : ''}>Moderate</option>
                                <option value="Severe" ${item?.severity === 'Severe' ? 'selected' : ''}>Severe</option>
                                <option value="Controlled" ${item?.severity === 'Controlled' ? 'selected' : ''}>Controlled</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-control" name="status" required>
                                <option value="Active" ${item?.status === 'Active' ? 'selected' : ''}>Active</option>
                                <option value="Resolved" ${item?.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
                                <option value="Chronic" ${item?.status === 'Chronic' ? 'selected' : ''}>Chronic</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;
            break;
        case 'diagnosis':
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" name="date" value="${item?.date || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Provider</label>
                            <input type="text" class="form-control" name="provider" value="${item?.provider || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Primary Diagnosis</label>
                            <input type="text" class="form-control" name="primary_diagnosis" value="${item?.primary_diagnosis || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Secondary Diagnosis</label>
                            <input type="text" class="form-control" name="secondary_diagnosis" value="${item?.secondary_diagnosis || ''}">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" name="notes" rows="3">${item?.notes || ''}</textarea>
                        </div>
                    </div>
                </div>
            `;
            break;
        case 'clinical_notes':
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" name="date" value="${item?.date || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Provider</label>
                            <input type="text" class="form-control" name="provider" value="${item?.provider || ''}" required>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="mb-3">
                            <label class="form-label">Note Type</label>
                            <select class="form-control" name="type" required>
                                <option value="Progress Note" ${item?.type === 'Progress Note' ? 'selected' : ''}>Progress Note</option>
                                <option value="Consultation" ${item?.type === 'Consultation' ? 'selected' : ''}>Consultation</option>
                                <option value="Assessment" ${item?.type === 'Assessment' ? 'selected' : ''}>Assessment</option>
                                <option value="Treatment Plan" ${item?.type === 'Treatment Plan' ? 'selected' : ''}>Treatment Plan</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="mb-3">
                            <label class="form-label">Clinical Note</label>
                            <textarea class="form-control" name="note" rows="5" required>${item?.note || ''}</textarea>
                        </div>
                    </div>
                </div>
            `;
            break;
        case 'allergies':
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Allergen</label>
                            <input type="text" class="form-control" name="allergen" value="${item?.allergen || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Date Identified</label>
                            <input type="date" class="form-control" name="date_identified" value="${item?.date_identified || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Severity</label>
                            <select class="form-control" name="severity" required>
                                <option value="Mild" ${item?.severity === 'Mild' ? 'selected' : ''}>Mild</option>
                                <option value="Moderate" ${item?.severity === 'Moderate' ? 'selected' : ''}>Moderate</option>
                                <option value="Severe" ${item?.severity === 'Severe' ? 'selected' : ''}>Severe</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Reaction</label>
                            <input type="text" class="form-control" name="reaction" value="${item?.reaction || ''}" required>
                        </div>
                    </div>
                </div>
            `;
            break;
        case 'immunizations':
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Vaccine</label>
                            <input type="text" class="form-control" name="vaccine" value="${item?.vaccine || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Date Administered</label>
                            <input type="date" class="form-control" name="date_administered" value="${item?.date_administered || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Provider</label>
                            <input type="text" class="form-control" name="provider" value="${item?.provider || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Lot Number</label>
                            <input type="text" class="form-control" name="lot_number" value="${item?.lot_number || ''}" required>
                        </div>
                    </div>
                </div>
            `;
            break;
        case 'appointments':
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" name="date" value="${item?.date || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Time</label>
                            <input type="time" class="form-control" name="time" value="${item?.time || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Provider</label>
                            <input type="text" class="form-control" name="provider" value="${item?.provider || ''}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Type</label>
                            <select class="form-control" name="type" required>
                                <option value="Follow-up" ${item?.type === 'Follow-up' ? 'selected' : ''}>Follow-up</option>
                                <option value="Consultation" ${item?.type === 'Consultation' ? 'selected' : ''}>Consultation</option>
                                <option value="Routine Check" ${item?.type === 'Routine Check' ? 'selected' : ''}>Routine Check</option>
                                <option value="Emergency" ${item?.type === 'Emergency' ? 'selected' : ''}>Emergency</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-control" name="status" required>
                                <option value="Scheduled" ${item?.status === 'Scheduled' ? 'selected' : ''}>Scheduled</option>
                                <option value="Completed" ${item?.status === 'Completed' ? 'selected' : ''}>Completed</option>
                                <option value="Cancelled" ${item?.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                                <option value="No Show" ${item?.status === 'No Show' ? 'selected' : ''}>No Show</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" name="notes" rows="3">${item?.notes || ''}</textarea>
                        </div>
                    </div>
                </div>
            `;
            break;
    }
    
    $('#itemFormFields').html(fieldsHtml);
    $('#itemModal').modal('show');
}

function saveItem() {
    const formData = new FormData($('#itemForm')[0]);
    const itemData = {};
    
    for (let [key, value] of formData.entries()) {
        itemData[key] = value;
    }
    
    if (editingItem) {
        itemData.id = editingItem.id;
    }
    
    const action = editingItem ? 'update' : 'add';
    
    $.ajax({
        url: `/api/patients/${currentPatient.id}/${currentSection}`,
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(itemData),
        success: function(response) {
            if (response.success) {
                showAlert(`${currentSection.slice(0, -1)} ${action}ed successfully!`, 'success');
                $('#itemModal').modal('hide');
                // Refresh patient data
                selectPatient(currentPatient.id);
            } else {
                showAlert('Error saving item', 'danger');
            }
        },
        error: function() {
            showAlert('Error saving item', 'danger');
        }
    });
}

function deleteItem(section, itemId) {
    if (confirm('Are you sure you want to delete this item?')) {
        // Map section names to proper API endpoints
        const endpointMap = {
            'medications': 'medications',
            'conditions': 'conditions', 
            'diagnosis': 'diagnoses',
            'clinical_notes': 'clinical-notes',
            'allergies': 'allergies',
            'immunizations': 'immunizations',
            'appointments': 'appointments'
        };
        
        const endpoint = endpointMap[section];
        if (!endpoint) {
            showAlert('Invalid section for deletion', 'danger');
            return;
        }
        
        $.ajax({
            url: `/api/${endpoint}/${itemId}`,
            method: 'DELETE',
            success: function(response) {
                if (response.success) {
                    showAlert(`${section.slice(0, -1)} deleted successfully!`, 'success');
                    // Refresh patient data
                    selectPatient(currentPatient.id);
                } else {
                    showAlert('Error deleting item', 'danger');
                }
            },
            error: function() {
                showAlert('Error deleting item', 'danger');
            }
        });
    }
}

// Function to open X-ray analysis with selected patient
function openXrayAnalysis() {
    if (!currentPatient || !currentPatient.id) {
        showAlert('Please select a patient first', 'warning');
        return;
    }
    
    // Open X-ray analysis page with patient ID
    window.location.href = `/xray-analysis?patient_id=${currentPatient.id}`;
}
</script>


<div id="volume-booster-visusalizer">
                    <div class="sound">
                        <div class="sound-icon"></div>
                        <div class="sound-wave sound-wave_one"></div>
                        <div class="sound-wave sound-wave_two"></div>
                        <div class="sound-wave sound-wave_three"></div>
                    </div>
                    <div class="segments-box">
                        <div data-range="1-20" class="segment"><span></span></div>
                        <div data-range="21-40" class="segment"><span></span></div>
                        <div data-range="41-60" class="segment"><span></span></div>
                        <div data-range="61-80" class="segment"><span></span></div>
                        <div data-range="81-100" class="segment"><span></span></div>
                    </div>
                </div></body></html>